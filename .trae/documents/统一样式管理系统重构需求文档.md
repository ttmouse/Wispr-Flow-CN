# 统一样式管理系统重构需求文档

## 1. 产品概述

本文档旨在解决ASR-FunASR项目中UI组件样式代码重复、分散、难以维护的问题，通过建立统一的样式管理系统，实现样式代码的集中管理和复用，提升代码质量和开发效率。

## 2. 核心功能

### 2.1 问题分析

当前项目存在的样式管理问题：

| 问题类型 | 具体表现 | 影响范围 |
|---------|---------|----------|
| 代码重复 | main_window.py中200+行内联样式，settings_window.py中大量重复样式定义 | 所有UI组件 |
| 硬编码分散 | 颜色值、字体、间距等直接写在各个组件中 | 维护困难，一致性差 |
| 缺乏统一管理 | 没有中央样式配置，修改样式需要多处更改 | 开发效率低 |
| 主题切换困难 | 样式硬编码导致无法灵活切换主题 | 用户体验受限 |

### 2.2 功能模块

#### 2.2.1 样式管理核心
- **ThemeManager**: 主题配置管理，支持明亮/暗黑/自动主题
- **StyleManager**: 单例模式的样式管理器，提供统一的样式获取接口
- **ComponentStyleBuilder**: 链式调用的样式构建器，支持灵活的样式组合

#### 2.2.2 预定义样式库
- **CommonStyles**: 常用组件样式集合（按钮、列表、窗口等）
- **ColorPalette**: 统一的颜色配置
- **Typography**: 字体和文本样式规范
- **Spacing**: 间距和布局规范

#### 2.2.3 样式应用机制
- **自动样式注入**: 组件初始化时自动应用对应样式
- **动态样式更新**: 支持运行时主题切换
- **样式继承**: 支持基础样式的扩展和覆盖

## 3. 技术方案

### 3.1 架构设计

```
统一样式管理系统
├── StyleManager (单例)
│   ├── 主题配置加载
│   ├── 样式值获取
│   └── 主题切换
├── ComponentStyleBuilder
│   ├── 链式样式构建
│   ├── 条件样式应用
│   └── CSS生成
├── CommonStyles
│   ├── 窗口样式
│   ├── 按钮样式
│   ├── 列表样式
│   └── 输入框样式
└── 主题配置文件
    ├── light_theme.json
    ├── dark_theme.json
    └── auto_theme.json
```

### 3.2 核心类设计

#### 3.2.1 StyleManager
```python
class StyleManager:
    """样式管理器 - 单例模式"""
    def __init__(self):
        self.current_theme = ThemeType.AUTO
        self.theme_config = {}
    
    def get_color(self, key: str) -> str
    def get_font(self, key: str) -> dict
    def get_spacing(self, key: str) -> int
    def set_theme(self, theme: ThemeType)
```

#### 3.2.2 ComponentStyleBuilder
```python
class ComponentStyleBuilder:
    """组件样式构建器 - 链式调用"""
    def background_color(self, color: str)
    def text_color(self, color: str)
    def font(self, family: str, size: int, weight: str)
    def padding(self, top: int, right: int, bottom: int, left: int)
    def border_radius(self, radius: int)
    def build(self) -> str
```

### 3.3 样式配置结构

```json
{
  "colors": {
    "primary": "#007AFF",
    "secondary": "#5856D6",
    "background": "#FFFFFF",
    "surface": "#F2F2F7",
    "text_primary": "#000000",
    "text_secondary": "#8E8E93"
  },
  "fonts": {
    "primary": {
      "family": "-apple-system",
      "size": 13,
      "weight": "normal"
    },
    "title": {
      "family": "-apple-system",
      "size": 16,
      "weight": "600"
    }
  },
  "spacing": {
    "xs": 4,
    "sm": 8,
    "md": 16,
    "lg": 24,
    "xl": 32
  },
  "border_radius": {
    "sm": 4,
    "md": 8,
    "lg": 12
  }
}
```

## 4. 实施计划

### 4.1 第一阶段：基础框架搭建（1-2天）
- [x] 创建unified_style_system.py基础框架
- [ ] 完善StyleManager类实现
- [ ] 创建主题配置文件
- [ ] 实现ComponentStyleBuilder

### 4.2 第二阶段：样式迁移（2-3天）
- [ ] 重构main_window.py样式代码
- [ ] 重构settings_window.py样式代码
- [ ] 迁移其他UI组件样式
- [ ] 创建CommonStyles预定义样式

### 4.3 第三阶段：功能完善（1-2天）
- [ ] 实现主题切换功能
- [ ] 添加样式热重载
- [ ] 优化性能和内存使用
- [ ] 编写单元测试

### 4.4 第四阶段：测试验证（1天）
- [ ] 功能测试
- [ ] 兼容性测试
- [ ] 性能测试
- [ ] 用户体验测试

