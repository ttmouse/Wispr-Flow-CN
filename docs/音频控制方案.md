# 录音时音频控制方案

## 目标
实现类似 Wispr Flow 的音频控制效果：
1. 按下录音快捷键时，其他应用的音频播放要暂停
2. 系统音量图标不显示静音状态
3. 能够播放我们自己的录音提示音

## 已尝试方案

### 1. 系统音量控制方式（2024-01-xx）
- 实现方式：通过修改系统音量来实现
- 效果：❌ 失败
- 问题：
  - 会显示静音图标
  - 用户体验不好
- 相关代码：[commit hash]

### 2. AVAudioSession 方式（2024-01-xx）
- 实现方式：使用 iOS/macOS 的音频会话管理
- 效果：❌ 失败
- 问题：
  - 在 macOS 上支持不完整
  - 有权限问题
  - 报错：'NewType' object has no attribute 'Default'
- 相关代码：[commit hash]

### 3. MediaRemote 框架方式（2024-01-xx）
- 实现方式：使用系统的媒体控制框架
- 效果：❌ 失败
- 问题：
  - 私有 API 调用不稳定
  - 无法正确控制应用
- 相关代码：[commit hash]

### 4. AppleScript 方式（2024-01-xx）
- 实现方式：直接控制各个应用的播放状态
- 效果：❌ 失败
- 问题：
  - 实际测试无效果
  - 可能需要额外的权限
- 相关代码：[commit hash]

## 待尝试方案

### 1. Core Audio 框架方式
- 计划：使用 Core Audio 框架直接控制音频流
- 预期优势：
  - 更底层的控制
  - 可能更稳定可靠
- 需要研究的内容：
  - Core Audio 框架的使用
  - 音频流的控制方式
  - 权限要求

### 2. Audio HAL 方式
- 计划：使用 Audio HAL (Hardware Abstraction Layer) 接口
- 预期优势：
  - 系统级别的控制
  - 不依赖应用层面的API
- 需要研究的内容：
  - Audio HAL 接口文档
  - 示例代码
  - 权限要求

### 3. Audio Unit 方式
- 计划：使用 Audio Unit 来控制音频路由
- 预期优势：
  - 更灵活的音频控制
  - 可能支持更细粒度的控制
- 需要研究的内容：
  - Audio Unit 的使用方法
  - 音频路由控制
  - 性能影响

## 下一步计划
1. 研究 Core Audio 框架的实现方式
2. 寻找相关的示例代码和文档
3. 测试权限要求和兼容性
4. 实现原型验证可行性

## 参考资料
- [Core Audio 官方文档]()
- [Audio HAL 文档]()
- [Audio Unit 编程指南]() 